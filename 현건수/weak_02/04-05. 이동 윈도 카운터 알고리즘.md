## 이동 윈도 카운터 알고리즘

> 고정 윈도 카운터 알고리즘과 이동 윈도 로깅 알고리즘을 결합한 것
> 

<p align="center">
  <img src="https://user-images.githubusercontent.com/76584547/224108839-61e396c0-011c-4520-8048-28060920c52e.png">
</p>


### 예제

- 분당 7개 요청
- 직전 1분에 5개 요청
- 현재 1분에 3개 요청

### 계산식

- 현재 1분간 요청 수 + 직전 1분간의 요청 수 x 이동 윈도와 직전 1분이 겹치는 비율
- 이 공식에 따르면 현재 윈도에 들어 있는 요청은 3+5 x 70% = 6.5개

### 설명

- 위 그림은, 분당 7개의 요청이라고 했으므로, 현재 1분의 30% 시점에 도착한 신규 요청은 시스템으로 전달될 것
- 하지만 그 직후에는 한도에 도달하였으므로 더이상의 요청은 받을 수 없다

### 장점

- 이전 시간대의 평균 처리율에 따라 현재 윈도의 상태를 계산하므로 짧은 시간에 몰리는 트래픽에도 잘 대응한다
- 메모리 효율이 좋다

### 단점

- 직전 시간대에 도착한 요청이 균등하게 분포되어 있다고 가정한 상태에서 추정치를 계산하기 때문에 다소 느슨하다
- 하지만 이는 심각한 것은 아닌데, 클라우드플레어가 실시했던 실험에 따르면 40억개의 요청 가운데 시스템의 실제 상태와 맞지 않게 허용되거나 버려진 요청은 0.003%에 불과했다
