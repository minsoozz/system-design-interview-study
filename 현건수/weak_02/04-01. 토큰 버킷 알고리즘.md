## 토큰 버킷 알고리즘

> 토큰 버킷은 처리율 제한에 폭넓게 이용되고 있다. 간단하고, 알고리즘에 대한 세간의 이해도도 높은 편이며 인터넷 기업들이 보편적으로 사용하고 있다. 아마존, 스트라이프가 이를 사용
토큰 버킷은 `지정된 용량을 갖는 컨테이너`

<p align="center">
  <img src="https://user-images.githubusercontent.com/76584547/224106922-47f33bea-dd96-4f2d-ad19-b12fceb13124.png">
</p>

**동작 원리**

1. 토큰 버킷은 사전 설정된 양의 토큰이 주기적으로 채워진다.
2. 토큰이 꽉 찬 버킷에는 더이상의 토큰은 추가되지 않는다.
3. 용량이 4인 버킷에 매초 2개의 토큰을 추가한다.
4. 버킷이 가득 차면 추가로 공급된 토큰은 버려진다.
5. 각 요청은 `처리될 때마다 하나의 토큰을 사용`한다.
6. 요청이 도착하면 버킷에 충분히 토큰이 있는지 검사한다.

**특징**

- 2개의 인자를 받는다
    - 버킷 크기 : 버킷에 담을 수 있는 토큰의 최대 개수
    - 토큰 공급률 : 초당 몇개의 토큰을 버킷에 공급되는가
- 통상적으로 API 엔드포인트마다 별도의 버킷을 둔다.
    - 예를들어, 사용자마다 하루에 한 번만 포스팅할 수 있고, 친구는 150명까지 추가할 수 있고, 좋아요 버튼은 다섯 번까지만 누를 수 있다면, 사요자마다 3개의 버킷을 두어야한다.
- IP 주소별로 처리한다면, IP 주소마다 버킷을 하나씩 할당해야한다.
- 시스템의 처리율을 초당 10000개 요청으로 제한하고 싶다면, 모든 요청이 하나의 버킷을 공유할 수 있어야한다.

**장점**

- 구현이 쉽다
- 메모리 사용 측면에서도 효율적이다
- 짧은 시간에 집중되는 트래픽도 처리 가능하다. 버킷에 남은 토큰이 있기만 하면 요청은 시스템에 전달될 것이다.

**단점**

- 버킷 크기와 토큰 공급률이라는 두개의 인자가 있는데, 이 값을 적절하게 튜닝하는 것은 까다로운 일이 될 것이다.
